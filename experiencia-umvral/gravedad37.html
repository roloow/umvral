<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>umVRal - Caida Libre</title>
    <meta name="description" content="Experiencia VR de caida libre">
    <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>
    <script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script>
    <script src="https://cdn.rawgit.com/etiennepinchon/aframe-material/master/dist/aframe-material.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.1/dist/aframe-extras.min.js"></script>
		<script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.1.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://momentjs.com/downloads/moment-with-locales.js"></script>

    <!-- ASSETS PATH -->
    <script type="text/javascript">
      AFRAME.ASSETS_PATH = "./assets";
    </script>
    <!-- /ASSETS PATH -->
  </head>
  <body>
    <!-- Inicio Marco -->
    <a-scene id="source" cursor="rayOrigin: mouse" physics="gravity:-3.71 ; friction:0 ; restitution:0 ; iterations: 1000" >
      <!-- Inicio BackGround y Suelo -->
      <a-sky src="assets/images/stars.jpeg"></a-sky> <!--marte -->
      <a-assets>
          <a-asset-item id="ground" src="https://cdn.rawgit.com/7ammer/testfiles/master/aframe-ground-physics/floor.dae"></a-asset-item>
      </a-assets>
      <!-- Fin BackGround y Suelo -->
      <!-- Inicio de Controles -->
      <a-entity laser-controls="hand: right"></a-entity>
      <a-entity id="cam" camera look-controls position="0 0 3" wasd-controls>
        <a-entity cursor="fuse: true; fuseTimeout: 1000"
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
            material="color: yellow; shader: flat">
            <a-animation begin="click" easing="ease-in" attribute="scale" dur="150" fill="forwards" from="0.2 0.2 0.2" to="1 1 1"></a-animation>
            <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" dur="1000" fill="backwards" from="1 1 1" to="0.2 0.2 0.2"></a-animation>

          </a-entity>
          <a-entity cursor="fuse: true; fuseTimeout: 1000"
            <a-text id="chron" position="-1 -1 -1" scale="1 1 1" id = "cronometro" color ="black" value="00:00:00"></a-text>
          </a-entity>
      </a-entity>
      <!-- Fin de Controles -->

      <!-- Inicio Escena #1 -->
      <!--
      <a-rounded id="scene1" position="4 0.3 -1" width="4" height="3.1" radius="0.05" rotation="0 -90 0" scale="0.6 0.6 0.6" color="#CCCCCC">
          <a-text value="Seleccione el lugar:" color="#000000" position="0.2 2.8 0"></a-text>
          <a-button id="l1" position="0.2 2.4 0" name="lugar1"  value="Tierra" button-color="#08147B"></a-button>
          <a-button id="l2" position="1.5 2.4 0" name="lugar2"  value="Luna"></a-button>
          <a-button id="l3" position="2.8 2.4 0" name="lugar3"  value="Marte"></a-button>

          <a-text value="Seleccione el peso del objeto" color="#000000" position="0.2 1.8 0"></a-text>
          <a-button id="p1" position="0.2 1.4 0" name="peso1"  value="0.5 kg" button-color="#08147B"></a-button>
          <a-button id="p2" position="1.5 1.4 0" name="peso2"  value="10 kg"></a-button>
          <a-button id="p3" position="2.8 1.4 0" name="peso3"  value="100 kg"></a-button>

          <a-button position="1.2 0.8 0" id="begin" name="stuff" value="COMENZAR" button-color="green" type="raised"></a-button>
      </a-rounded>-->
      <!-- Fin Escena #1 -->

      <!-- Inicio Escena #2 -->
      <a-entity id="m100"  geometry="primitive: box" position="5 99 -15"  scale ="5 1 0.5" value="100 metros" ></a-entity>
			<a-entity id="m35"  geometry="primitive: box" position="5 34 -15"  scale ="5 1 0.5" value="35 metros" ></a-entity>
			<a-entity id="m15"  geometry="primitive: box" position="5 14 -15"  scale ="5 1 0.5" value="15 metros"></a-entity>
			<a-entity id="m5"  geometry="primitive: box" color= "white" position="5 4 -15"  scale ="5 1 0.5" value="5 metros"></a-entity>

			<a-text id="regla90" position="2 89 -15" scale="5 5 5" name="obj" label="15" color="white" value= "90 m"></a-text>
			<a-text id="regla80" position="2 79 -15" scale="5 5 5" name="obj" label="15" color="white" value= "80 m"></a-text>
			<a-text id="regla70" position="2 69 -15" scale="5 5 5" name="obj" label="15" color="white" value= "70 m"></a-text>
			<a-text id="regla60" position="2 59 -15" scale="5 5 5" name="obj" label="15" color="white" value= "60 m"></a-text>
			<a-text id="regla50" position="2 49 -15" scale="5 5 5" name="obj" label="15" color="white" value= "50 m"></a-text>
			<a-text id="regla40" position="2 39 -15" scale="5 5 5" name="obj" label="15" color="white" value= "40 m"></a-text>
			<a-text id="regla30" position="2 29 -15" scale="5 5 5" name="obj" label="15" color="white" value= "30 m"></a-text>
			<a-text id="regla20" position="2 19 -15" scale="5 5 5" name="obj" label="15" color="white" value= "20 m"></a-text>
			<a-text id="regla10" position="2 9 -15" scale="5 5 5" name="obj" label="15" color="white" value= "10 m"></a-text>
      <a-text id="regla10" position="3 4 -14.75" scale="5 5 5" name="obj" label="15" color="black" value= "5 m"></a-text>
      <a-text id="regla10" position="3 14 -14.75" scale="5 5 5" name="obj" label="15" color="black" value= "15 m"></a-text>
      <a-text id="regla10" position="3 34 -14.75" scale="5 5 5" name="obj" label="15" color="black" value= "35 m"></a-text>
      <a-text id="regla10" position="3 99 -14.75" scale="5 5 5" name="obj" label="15" color="black" value= "100 m"></a-text>
			  <a-sphere id="objeto" color="red"
         position="0 0 -15"
         radius="0.3"
         dynamic-body="mass: 0.5; sphereRadius: 0.3;"

          ></a-sphere>
         <a-cylinder color="white"
           position="2 49 -15"
           scale="0.05 100 0.1"
           static-body></a-cylinder>

           <a-cylinder
             position="2 -2 -15"
             material= "color:  #bc402a "
             scale="10000 0.5 10000"
             dinamic-body></a-cylinder>

          <a-text id="chron" clock-text position="-14 0 -13" scale="10 10 10" rotation ="-45 40 0" id = "cronometro" color ="black" value="00:00:00"></a-text>
          <a-entity
          geometry="primitive: box"
          material = "color : blue"
          position = "-10 -2 -15"
          rotation="-45 40 0"
          scale = " 10 10 1"
          ></a-entity>

         <a-cylinder
           id= 'suelo'
           position="2 -1.5 -15"
           material= "color: #c4d7d8"
           scale="7.5 0.5 7.5"
           dinamic-body></a-cylinder>
      <a-entity static-body collada-model="#ground" visible = "false" position= "0 -1 0"></a-entity>
      <!-- Fin Escena #2 -->
    </a-scene>
    <!-- Fin Marco -->

    <script type="text/javascript">
    function dettachDin() {
  		objeto.removeAttribute("dynamic-body");
      console.log(objeto);
  	}

  	function attachDin() {
      var attr = document.createAttribute('dynamic-body');
  		attr.value = 'mass: '+ weight + ';';
      objeto.setAttributeNode(attr)
      console.log(objeto);
  	}

    function setHeight(height) {
  		dettachDin();
  		objeto.object3D.position.set(0, height, -15);
      resetChron();
  		attachDin();
  	}

    function resetChron(){
      currentTimestamp = moment();
      clockrun = true;
    }



    let cronometro = document.getElementById('chron');
    let l1 = document.getElementById('l1');
    let l2 = document.getElementById('l2');
    let l3 = document.getElementById('l3');
    let p1 = document.getElementById('p1');
    let p2 = document.getElementById('p2');
    let p3 = document.getElementById('p3');
    let begin = document.getElementById('begin');
    let sky = document.querySelector('a-sky');
    let	reset5 	= document.getElementById('m5');
  	let	reset15 = document.getElementById('m15');
  	let	reset35 = document.getElementById('m35');
  	let	reset100 = document.getElementById('m100');
  	let	objeto	 = document.getElementById('objeto');
    var currentTimestamp = moment();
    var clockrun = false;
    let weight = 1;

    function startChron() {
      cronometro.setAttribute("value","200");

    }

    reset5.addEventListener("click", function(){
  		setHeight(4);
  	});

  	reset15.addEventListener("click", function(){
  		setHeight(14);
  	});

  	reset35.addEventListener("click", function(){
  		setHeight(34);
  	});

  	reset100.addEventListener("click", function(){
  		setHeight(99);
  	});

    cronometro.addEventListener("click",function(){
      clockrun = false;
    })

/*
    object.addEventListener('collide',function(e){

        if(e.object3D.position.y > "-0.7") {
          clockrun = true;
        }
    })*/


    AFRAME.registerComponent('clock-text', {
      init: function() {
        var el = this.el;
        this.ready = false;
          el.addEventListener('textfontset', function() {
          this.ready = true;
        }.bind(this));
      },
      tick: function() {
        var el = this.el;
        if (!this.ready) {
          return;
        }
        if(clockrun){
          var timer = moment.duration(moment().diff(currentTimestamp));
          el.setAttribute('value', timer.asSeconds());
        }


      }
    });




    </script>
  </body>
</html>
